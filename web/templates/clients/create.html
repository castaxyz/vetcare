{% extends "base.html" %}

{% block title %}Nuevo Cliente - VetCare{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('clients.list_clients') }}">Clientes</a></li>
                    <li class="breadcrumb-item active">Nuevo Cliente</li>
                </ol>
            </nav>
            <h1 class="h3 mb-0">
                <i class="bi bi-person-plus me-2"></i>Nuevo Cliente
            </h1>
            <p class="text-muted">Registrar un nuevo propietario de mascotas</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-person-badge me-2"></i>Información del Cliente
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" novalidate class="needs-validation">
                        <div class="row">
                            <!-- Nombres -->
                            <div class="col-md-6 mb-3">
                                <label for="first_name" class="form-label">
                                    <i class="bi bi-person me-1 text-primary"></i>Nombre <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="first_name" 
                                       name="first_name"
                                       value="{{ first_name if first_name is defined else '' }}" 
                                       required
                                       minlength="2"
                                       maxlength="50">
                                <div class="valid-feedback">
                                    ¡Se ve bien!
                                </div>
                                <div class="invalid-feedback">
                                    El nombre es requerido (2-50 caracteres).
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="last_name" class="form-label">
                                    <i class="bi bi-person me-1 text-primary"></i>Apellido <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="last_name" 
                                       name="last_name"
                                       value="{{ last_name if last_name is defined else '' }}" 
                                       required
                                       minlength="2"
                                       maxlength="50">
                                <div class="valid-feedback">
                                    ¡Se ve bien!
                                </div>
                                <div class="invalid-feedback">
                                    El apellido es requerido (2-50 caracteres).
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Contacto -->
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">
                                    <i class="bi bi-envelope me-1 text-success"></i>Email
                                </label>
                                <input type="email" 
                                       class="form-control" 
                                       id="email" 
                                       name="email"
                                       value="{{ email if email is defined else '' }}"
                                       maxlength="100">
                                <div class="valid-feedback">
                                    Email válido.
                                </div>
                                <div class="invalid-feedback">
                                    Por favor ingresa un email válido.
                                </div>
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Opcional - para enviar recordatorios automáticos
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">
                                    <i class="bi bi-telephone me-1 text-info"></i>Teléfono
                                </label>
                                <input type="tel" 
                                       class="form-control" 
                                       id="phone" 
                                       name="phone"
                                       value="{{ phone if phone is defined else '' }}"
                                       placeholder="555-1234-5678"
                                       maxlength="20">
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Opcional - para contacto directo
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Identificación -->
                            <div class="col-md-6 mb-3">
                                <label for="identification_number" class="form-label">
                                    <i class="bi bi-card-text me-1 text-warning"></i>Número de Identificación
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="identification_number" 
                                       name="identification_number"
                                       value="{{ identification_number if identification_number is defined else '' }}"
                                       placeholder="Cédula, DPI, Pasaporte, etc."
                                       maxlength="20">
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Opcional - documento de identidad oficial
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="address" class="form-label">
                                <i class="bi bi-geo-alt me-1 text-secondary"></i>Dirección
                            </label>
                            <textarea class="form-control" 
                                      id="address" 
                                      name="address" 
                                      rows="3"
                                      maxlength="255"
                                      placeholder="Dirección completa del cliente (calle, colonia, ciudad, código postal)">{{ address if address is defined else '' }}</textarea>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>
                                Opcional - para entregas a domicilio o visitas
                            </div>
                        </div>

                        <!-- Divider -->
                        <hr class="my-4">

                        <!-- Botones -->
                        <div class="row">
                            <div class="col">
                                <div class="d-flex justify-content-between align-items-center">
                                    <a href="{{ url_for('clients.list_clients') }}" class="btn btn-outline-secondary">
                                        <i class="bi bi-arrow-left me-2"></i>Volver a la Lista
                                    </a>
                                    
                                    <div>
                                        <button type="reset" class="btn btn-outline-warning me-2" onclick="clearForm()">
                                            <i class="bi bi-x-circle me-1"></i>Limpiar
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-person-plus me-2"></i>Crear Cliente
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Panel de ayuda -->
        <div class="col-lg-4">
            <div class="card border-primary">
                <div class="card-header bg-light">
                    <h6 class="mb-0 text-primary">
                        <i class="bi bi-lightbulb me-2"></i>Consejos Útiles
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                        <div>
                            <strong>Campos obligatorios</strong>
                            <p class="mb-0 small text-muted">Solo nombre y apellido son obligatorios para crear el cliente</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-envelope-check-fill text-info me-2 mt-1"></i>
                        <div>
                            <strong>Email importante</strong>
                            <p class="mb-0 small text-muted">Con el email podrás enviar recordatorios automáticos de citas y vacunas</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-telephone-fill text-warning me-2 mt-1"></i>
                        <div>
                            <strong>Teléfono útil</strong>
                            <p class="mb-0 small text-muted">Para contactar rápidamente en caso de emergencias o confirmaciones</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start">
                        <i class="bi bi-arrow-right-circle-fill text-primary me-2 mt-1"></i>
                        <div>
                            <strong>Siguiente paso</strong>
                            <p class="mb-0 small text-muted">Una vez creado el cliente podrás registrar sus mascotas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estadísticas rápidas -->
            <div class="card mt-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="bi bi-graph-up me-2"></i>Estadísticas
                    </h6>
                </div>
                <div class="card-body text-center">
                    <div class="row">
                        <div class="col-6">
                            <div class="border-end">
                                <div class="h5 text-primary mb-0">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                                <small class="text-muted">Clientes en el sistema</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-success mb-0">
                                <i class="bi bi-heart-fill"></i>
                            </div>
                            <small class="text-muted">Mascotas registradas</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Validación del formulario Bootstrap
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Auto-formato de teléfono
document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 0) {
        if (value.length <= 3) {
            value = value;
        } else if (value.length <= 7) {
            value = value.slice(0, 3) + '-' + value.slice(3);
        } else {
            value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
    }
    e.target.value = value;
});

// Función para limpiar formulario
function clearForm() {
    const form = document.querySelector('form');
    form.reset();
    form.classList.remove('was-validated');
    
    // Limpiar clases de validación
    form.querySelectorAll('.is-valid, .is-invalid').forEach(element => {
        element.classList.remove('is-valid', 'is-invalid');
    });
}

// Capitalizar nombres automáticamente
document.getElementById('first_name').addEventListener('input', function(e) {
    e.target.value = e.target.value.charAt(0).toUpperCase() + e.target.value.slice(1).toLowerCase();
});

document.getElementById('last_name').addEventListener('input', function(e) {
    e.target.value = e.target.value.charAt(0).toUpperCase() + e.target.value.slice(1).toLowerCase();
});

// Contador de caracteres para textarea
document.getElementById('address').addEventListener('input', function(e) {
    const maxLength = 255;
    const currentLength = e.target.value.length;
    const remaining = maxLength - currentLength;
    
    let counterElement = document.getElementById('addressCounter');
    if (!counterElement) {
        counterElement = document.createElement('div');
        counterElement.id = 'addressCounter';
        counterElement.className = 'form-text text-end';
        e.target.parentNode.appendChild(counterElement);
    }
    
    counterElement.innerHTML = `${currentLength}/${maxLength} caracteres`;
    counterElement.className = remaining < 50 ? 'form-text text-end text-warning' : 'form-text text-end text-muted';
});
</script>
{% endblock %}